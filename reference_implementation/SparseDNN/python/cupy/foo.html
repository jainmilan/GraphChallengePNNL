<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<style>
.r1 {color: #005f00; text-decoration-color: #005f00}
.r2 {font-weight: bold}
.r3 {color: #000080; text-decoration-color: #000080; font-weight: bold}
.r4 {color: #87af00; text-decoration-color: #87af00; font-weight: bold}
.r5 {color: #005f00; text-decoration-color: #005f00; font-weight: bold}
.r6 {color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold}
.r7 {color: #000080; text-decoration-color: #000080; font-weight: bold; font-style: italic}
.r8 {color: #87af00; text-decoration-color: #87af00; font-weight: bold; font-style: italic}
.r9 {color: #005f00; text-decoration-color: #005f00; font-weight: bold; font-style: italic}
.r10 {color: #7f7f7f; text-decoration-color: #7f7f7f}
.r11 {color: #000080; text-decoration-color: #000080}
.r12 {color: #87af00; text-decoration-color: #87af00}
.r13 {font-weight: bold; font-style: italic}
.r14 {color: #000000; text-decoration-color: #000000; background-color: #f8f8f8}
.r15 {background-color: #f8f8f8}
.r16 {color: #800000; text-decoration-color: #800000; font-weight: bold}
.r17 {font-style: italic}
.r18 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8}
.r19 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8; font-weight: bold}
.r20 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8}
.r21 {color: #3d7b7b; text-decoration-color: #3d7b7b; background-color: #f8f8f8; font-style: italic}
.r22 {color: #666666; text-decoration-color: #666666; background-color: #f8f8f8}
.r23 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8; font-weight: bold}
.r24 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8}
.r25 {color: #008080; text-decoration-color: #008080; font-weight: bold}
.r26 {color: #0000ff; text-decoration-color: #0000ff}
body {
    color: #000000;
    background-color: #ffffff;
}
</style>
</head>
<html>
<body>
    <code>
        <pre style="font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                           Memory usage: <span class="r1">▆▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁</span> (max:   1.71GB, growth rate:   1%)                            
/qfs/projects/pacer/milan/code/GraphChallengePNNL/reference_implementation/SparseDNN/python/cupy/readTriples.py: % of time =  59.19
                                                          out of  16.20.                                                           
       ╷       ╷       ╷      ╷       ╷       ╷       ╷               ╷       ╷                                                    
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––…</span><span class="r2"> </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r5">Memory</span><span class="r2"> </span>│<span class="r5">––––––</span><span class="r2"> </span>│<span class="r5">–––––––––––</span><span class="r2">    </span>│<span class="r4">Copy</span><span class="r2">   </span>│<span class="r2">                                                   </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">syst…</span><span class="r2"> </span>│<span class="r8">GPU</span><span class="r2">    </span>│<span class="r9">Python</span><span class="r2"> </span>│<span class="r9">peak</span><span class="r2">   </span>│<span class="r9">timeline</span><span class="r5">/%</span><span class="r2">     </span>│<span class="r8">(MB/s)</span><span class="r2"> </span>│<span class="r2">/qfs/projects/pacer/milan/code/GraphChallengePNNL… </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">  ... </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│                                                    
 <span class="r10">      </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│                                                    
╶──────┼───────┼───────┼──────┼───────┼───────┼───────┼───────────────┼───────┼───────────────────────────────────────────────────╴
 <span class="r10">      </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">function summary for /qfs/projects/pacer/milan/co…</span>  
 <span class="r10">    6 </span>│<span class="r11">    2% </span>│<span class="r11">    4% </span>│<span class="r11">   3% </span>│<span class="r12">  3%   </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">readTriples</span><span class="r15">                                       </span>  
 <span class="r10">   21 </span>│<span class="r16">   29%</span><span class="r11"> </span>│<span class="r16">   10%</span><span class="r11"> </span>│<span class="r11">   7% </span>│<span class="r16"> 56%</span><span class="r12">   </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">StrFileRead</span><span class="r15">                                       </span>  
       ╵       ╵       ╵      ╵       ╵       ╵       ╵               ╵       ╵                                                    
<span class="r17">                                    runSparseDNNchallenge.py: % of time =  40.81 out of  16.20.                                    </span>
       ╷       ╷       ╷      ╷       ╷       ╷       ╷               ╷       ╷                                                    
 <span class="r2">      </span>│<span class="r3">Time</span><span class="r2">   </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––…</span><span class="r2"> </span>│<span class="r4">––––––</span><span class="r2"> </span>│<span class="r5">Memory</span><span class="r2"> </span>│<span class="r5">––––––</span><span class="r2"> </span>│<span class="r5">–––––––––––</span><span class="r2">    </span>│<span class="r4">Copy</span><span class="r2">   </span>│<span class="r2">                                                   </span> 
 <span class="r2"> </span><span class="r6">Line</span><span class="r2"> </span>│<span class="r7">Python</span><span class="r2"> </span>│<span class="r7">native</span><span class="r2"> </span>│<span class="r7">syst…</span><span class="r2"> </span>│<span class="r8">GPU</span><span class="r2">    </span>│<span class="r9">Python</span><span class="r2"> </span>│<span class="r9">peak</span><span class="r2">   </span>│<span class="r9">timeline</span><span class="r5">/%</span><span class="r2">     </span>│<span class="r8">(MB/s)</span><span class="r2"> </span>│<span class="r2">runSparseDNNchallenge.py                           </span> 
╺━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r10">  ... </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│                                                    
 <span class="r10">   53 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r18">@profile</span><span class="r15">                                          </span>  
 <span class="r10">   54 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r19">def</span><span class="r14"> </span><span class="r20">inferenceReLUvec</span><span class="r14">(W, bias, Y0):</span><span class="r15">                </span>  
 <span class="r10">   55 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r21"># Performs ReLU inference  using input feature</span>  
 <span class="r10">   56 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r21"># DNN weights W, and constant bias.</span><span class="r15">           </span>  
 <span class="r10">   57 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    YMAX </span><span class="r22">=</span><span class="r14"> </span><span class="r22">32</span><span class="r14"> </span><span class="r21"># set max value</span><span class="r15">                     </span>  
 <span class="r10">   58 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">                                                  </span>  
 <span class="r10">   59 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r21"># Initialized feature vectors.</span><span class="r15">                </span>  
 <span class="r10">   60 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    Y </span><span class="r22">=</span><span class="r14"> Y0</span><span class="r15">                                        </span>  
 <span class="r10">   61 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">                                                  </span>  
 <span class="r10">   62 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r21"># spgemm time list</span><span class="r15">                            </span>  
 <span class="r10">   63 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    spgemmTimes </span><span class="r22">=</span><span class="r14"> []</span><span class="r15">                              </span>  
 <span class="r10">   64 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r15">                                              </span>  
 <span class="r10">   65 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r21"># loop through each weight layer W[i]</span><span class="r15">         </span>  
 <span class="r10">   66 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r19">for</span><span class="r14"> i </span><span class="r23">in</span><span class="r14"> </span><span class="r24">range</span><span class="r14">(</span><span class="r24">len</span><span class="r14">(W)):</span><span class="r15">                       </span>  
 <span class="r10">   67 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r15">                                          </span>  
 <span class="r10">   68 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r21"># tic = time.perf_counter()</span><span class="r15">               </span>  
 <span class="r10">   69 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r21"># % Propagate through layer.</span><span class="r15">              </span>  
 <span class="r10">   70 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r21"># % Note: using graph convention of A(i,j)</span>  
 <span class="r10">   71 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r21"># % that requires *left* multiplication fe</span>  
 <span class="r10">   72 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        tic </span><span class="r22">=</span><span class="r14"> time</span><span class="r22">.</span><span class="r14">perf_counter();</span><span class="r15">                </span>  
 <span class="r10">   73 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        Y </span><span class="r22">=</span><span class="r14"> Y </span><span class="r22">@</span><span class="r14"> W[i]</span><span class="r15">                              </span>  
 <span class="r10">   74 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        spgemmTime </span><span class="r22">=</span><span class="r14"> time</span><span class="r22">.</span><span class="r14">perf_counter() </span><span class="r22">-</span><span class="r14"> tic;</span><span class="r15">   </span>  
 <span class="r10">   75 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        spgemmTimes</span><span class="r22">.</span><span class="r14">append(spgemmTime)</span><span class="r15">            </span>  
 <span class="r10">   76 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r15">                                          </span>  
 <span class="r10">   77 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r21"># Apply bias to non-zero entries.</span><span class="r15">         </span>  
 <span class="r10">   78 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">  82%  </span>│<span class="r1">    2M </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        Y</span><span class="r22">.</span><span class="r14">data </span><span class="r22">=</span><span class="r14"> cp</span><span class="r22">.</span><span class="r14">where(Y</span><span class="r22">.</span><span class="r14">data </span><span class="r22">&lt;</span><span class="r14"> </span><span class="r22">-</span><span class="r14">bias,  </span><span class="r22">0</span><span class="r14">, cp</span><span class="r22">.</span><span class="r14">w</span>  
 <span class="r10">   79 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r15">                                          </span>  
 <span class="r10">   80 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        </span><span class="r21"># eliminate zero entries</span><span class="r15">                  </span>  
 <span class="r10">   81 </span>│<span class="r16">    4%</span><span class="r11"> </span>│<span class="r16">   12%</span><span class="r11"> </span>│<span class="r11">  13% </span>│<span class="r16"> 20%</span><span class="r12">   </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">        Y</span><span class="r22">.</span><span class="r14">eliminate_zeros()</span><span class="r15">                       </span>  
 <span class="r10">   82 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r15">                                                  </span>  
 <span class="r10">   83 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    challengeRunTime </span><span class="r22">=</span><span class="r14"> np</span><span class="r22">.</span><span class="r14">sum(spgemmTimes)</span><span class="r15">        </span>  
 <span class="r10">   84 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r15">                                              </span>  
 <span class="r10">   85 </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r14">    </span><span class="r19">return</span><span class="r14"> Y, challengeRunTime</span><span class="r15">                    </span>  
 <span class="r10">  ... </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│                                                    
 <span class="r10">      </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│                                                    
╶──────┼───────┼───────┼──────┼───────┼───────┼───────┼───────────────┼───────┼───────────────────────────────────────────────────╴
 <span class="r10">      </span>│<span class="r11">       </span>│<span class="r11">       </span>│<span class="r11">      </span>│<span class="r12">       </span>│<span class="r1">       </span>│<span class="r1">       </span>│<span class="r1">               </span>│<span class="r12">       </span>│<span class="r13">function summary for runSparseDNNchallenge.py     </span>  
 <span class="r10">   53 </span>│<span class="r16">    4%</span><span class="r11"> </span>│<span class="r16">   12%</span><span class="r11"> </span>│<span class="r11">  14% </span>│<span class="r16"> 20%</span><span class="r12">   </span>│<span class="r1">  82%  </span>│<span class="r1">    2M </span>│<span class="r16">▁</span><span class="r1">              </span>│<span class="r12">       </span>│<span class="r14">inferenceReLUvec</span><span class="r15">                                  </span>  
       ╵       ╵       ╵      ╵       ╵       ╵       ╵               ╵       ╵                                                    
Top AVERAGE memory consumption, by line:
<span class="r1">(1)    90:   614 MB</span>                                                                                                                 
<span class="r1">(2)     8:     8 MB</span>                                                                                                                 
<span class="r1">(3)   110:     3 MB</span>                                                                                                                 
<span class="r1">(4)     2:     2 MB</span>                                                                                                                 
<span class="r1">(5)    78:     2 MB</span>                                                                                                                 
Top PEAK memory consumption, by line:
<span class="r1">(1)    90:  1720 MB</span>                                                                                                                 
<span class="r1">(2)     8:    14 MB</span>                                                                                                                 
<span class="r1">(3)     4:    13 MB</span>                                                                                                                 
<span class="r1">(4)   110:     7 MB</span>                                                                                                                 
<span class="r1">(5)     2:     5 MB</span>                                                                                                                 
Possible memory leak identified at line <span class="r25">90</span> <span class="r2">(</span>estimated likelihood:  <span class="r25">99</span>%, velocity:  <span class="r25">38</span> MB/s<span class="r2">)</span>
generated by the <a class="r26" href="https://github.com/plasma-umass/scalene">scalene</a> profiler                                                                                                   
</pre>
    </code>
</body>
</html>
